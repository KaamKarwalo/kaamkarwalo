
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Worker Dashboard - KaamKarwalo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body { background-color: #f4f6f9; font-family: 'Segoe UI', sans-serif; }
    .sidebar { height: 100vh; background-color: #1e2a38; color: white; padding-top: 20px; position: fixed; top: 0; left: 0; width: 250px; z-index: 1050; }
    .sidebar h4 { text-align: center; margin-bottom: 30px; }
    .sidebar ul { list-style: none; padding-left: 0; }
    .sidebar ul li { padding: 15px 25px; cursor: pointer; border-left: 4px solid transparent; transition: background-color 0.3s, border-color 0.3s; }
    .sidebar ul li:hover, .sidebar ul li.active { background-color: #27394d; border-left: 4px solid #0dcaf0; }
    .section { display: none; background-color: white; padding: 25px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .section.active { display: block; }
    .toggle-btn { display: none; background: #1e2a38; color: white; border: none; padding: 10px 15px; font-size: 18px; position: fixed; top: 10px; left: 10px; z-index: 1100; border-radius: 5px; }
    @media (max-width: 768px) {
      .sidebar { transform: translateX(-100%); transition: transform 0.3s ease; }
      .sidebar.show { transform: translateX(0); }
      .toggle-btn { display: block; }
      .main-content { margin-left: 0; padding-top: 50px; }
    }
    @media (min-width: 769px) {
      .main-content { margin-left: 250px; }
    }
  </style>
</head>
<body>
<button class="toggle-btn" onclick="toggleSidebar()">‚ò∞</button>

<div class="sidebar" id="sidebar">
  <h4>Worker Panel</h4>
  <ul>
    <li onclick="showSection('editProfile')">Edit Profile</li>
    <li onclick="showSection('newBookings')">New Bookings</li>
    <li onclick="showSection('pastBookings')">Past Bookings</li>
    <li onclick="goHome()">üè† Go to Home Page</li>
    <li onclick="logout()">Logout</li>
  </ul>
</div>

<div class="container-fluid main-content py-4 px-3">
  <h2 id="workerWelcome">Welcome, Worker</h2>

  <!-- Edit Profile -->
  <div id="editProfile" class="section">
    <h4>Edit Profile</h4>
    <form id="profileForm"></form>
  </div>

  <!-- New Bookings -->
  <div id="newBookings" class="section">
    <h4>New Bookings Assigned</h4>
    <p class="text-muted">Bookings will be displayed here.</p>
    <table class="table table-bordered">
      <thead><tr><th>Customer</th><th>Service</th><th>Date</th><th>Status</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Past Bookings -->
  <div id="pastBookings" class="section">
    <h4>Past Booking History</h4>
    <p class="text-muted">Past bookings will be displayed here.</p>
    <table class="table table-bordered">
      <thead><tr><th>Customer</th><th>Service</th><th>Date</th><th>Payment</th><th>Rating</th><th>Feedback</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
if (!localStorage.getItem('worker')) {
  window.location.href = 'index.html';
}

const worker = JSON.parse(localStorage.getItem('worker'));

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('show');
}

function showSection(id) {
  $('.section').removeClass('active');
  $('#' + id).addClass('active');
  if (id === 'editProfile') loadProfile();
  if (window.innerWidth <= 768) toggleSidebar();
}

function goHome() { window.location.href = 'index.html'; }
function logout() { localStorage.removeItem('worker'); window.location.href = 'index.html'; }

// Load profile data
async function loadProfile() {
  const res = await fetch(`https://kaamkarwalo-backend.onrender.com/api/users/${worker._id}`);
  const data = await res.json();
  $('#profileForm').html(`
    <input class="form-control mb-2" name="name" value="${data.name}" placeholder="Name" />
    <input class="form-control mb-2" name="phone" value="${data.phone}" placeholder="Phone" />
    <input class="form-control mb-2" name="email" value="${data.email || ''}" placeholder="Email" />
    <input class="form-control mb-2" name="address" value="${data.address || ''}" placeholder="Address" />
    <input class="form-control mb-2" name="city" value="${data.city || ''}" placeholder="City" />
    <input class="form-control mb-2" name="district" value="${data.district || ''}" placeholder="District" />
    <input class="form-control mb-2" name="state" value="${data.state || ''}" placeholder="State" />
    <input class="form-control mb-2" name="workerType" value="${data.workerType || ''}" placeholder="Worker Type" />
    <input class="form-control mb-2" name="location" value="${data.location || ''}" placeholder="Google Map Link" />
    <button type="submit" class="btn btn-primary">Save Changes</button>
  `);

  $('#profileForm').off('submit').on('submit', async function(e) {
    e.preventDefault();
    const updated = Object.fromEntries(new FormData(this).entries());
    await fetch(`https://kaamkarwalo-backend.onrender.com/api/users/${worker._id}`, {
      method: 'PUT', headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(updated)
    });
    alert('Profile updated');
    localStorage.setItem('worker', JSON.stringify({...worker, ...updated}));
  });
}

window.onload = () => {
  $('#workerWelcome').text(`Welcome, ${worker.name}`);
  showSection('editProfile');
}
</script>
</body>
</html>
